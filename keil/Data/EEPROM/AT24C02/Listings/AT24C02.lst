C51 COMPILER V9.54   AT24C02                                                               02/08/2022 01:02:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AT24C02
OBJECT MODULE PLACED IN .\Objects\AT24C02.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE AT24C02.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\AT24C02.lst) TABS(2) OBJECT(.\Objects\AT24C02.obj)

line level    source

   1          /**
   2           * @file AT24C02.c
   3           * @author kingnan (github.com/kingnan-Guo/PBC)
   4           * @brief å¯ä»¥ç”µæ“¦é™¤çš„ å†…éƒ¨å‚¨å­˜å™¨ï¼Œ æ–­ç”µä¸æ¶ˆå¤±;ä½¿ç”¨ I2Cçš„æ–¹å¼è¿›è¡Œæ•°æ®å­˜å‚¨
   5           * @version 0.1
   6           * @date 2022-02-06
   7           * 
   8           * @copyright Copyright (c) 2022
   9           * 
  10           */
  11          
  12          #include"reg51.h"
  13          #include"intrins.h"
  14          // #include "stdio.h"
  15          
  16          // ----- I2C çš„æ¥å£ ------
  17          sbit SDA = P3^0;
  18          sbit SCL = P3^1;
  19          
  20          //  ----- æŒ‰é’® ---
  21          sbit button1 = P1^0;
  22          
  23          
  24          
  25          // ---- æµ‹è¯•å†™å…¥çš„æ•°æ® --
  26          unsigned char testData[] = {9, 3, 5, 4};
  27          
  28          // åˆå§‹åŒ– AT24C02 
  29          // void initAT24C02() {
  30          //     _nop_();
  31          // }
  32          
  33          
  34          
  35          // å»¶æ—¶å‡½æ•°
  36          void delay(num) {
  37   1          int i = 0;
  38   1          for (i = 0; i < num; i++)
  39   1          {
  40   2              _nop_(); // _nop_(); ä»£è¡¨è¿è¡Œä¸€ä¸ªæœºå™¨å‘¨æœŸ. å¦‚æœè¿™ä¸ªå•ç‰‡æœºçš„æ™¶æŒ¯æ˜¯12Mçš„ï¼Œé‚£
             -ä¹ˆè¿™è°ƒä»£ç ä¼šè¿è¡Œ1US
  41   2              // printf("%d",num);
  42   2          }
  43   1      }
  44          
  45          // 89C51 æ²¡æœ‰I2Cï¼Œ æ‰€ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ—¶åºæ“ä½œ I2C
  46          // SCL åœ¨é«˜ç”µå¹³è¿‡ç¨‹ä¸­ï¼Œ SDA æœ‰ä¸‹é™æ²¿ï¼Œè¿™æ—¶ å¼€å¯äº†I2C
  47          void I2C_star() {
  48   1          SDA = 1;
  49   1          SCL = 1;
  50   1          delay(5); // å»¶æ—¶5us, æ—¶é—´è¦å¤§äº 4.7usï¼Œ 
  51   1          SDA = 0; // å°†SDAå¤„äºä½ç”µå¹³ï¼Œå¼€å§‹ I2C
  52   1          delay(5); // æ—¶é—´è¦å¤§äºé¢ 4us
  53   1          SCL = 0;
C51 COMPILER V9.54   AT24C02                                                               02/08/2022 01:02:06 PAGE 2   

  54   1      
  55   1      }
  56          
  57          // åœæ­¢
  58          void I2C_stop() {
  59   1          SCL = 1;
  60   1          SDA = 0;
  61   1          delay(5);
  62   1          SDA = 1; // å½“ SCL ä¸ºé«˜ç”µå¹³çš„æƒ…å†µä¸‹ï¼Œ SDAä¸ºé«˜ç”µå¹³ï¼›
  63   1          delay(5);
  64   1          SCL = 0;
  65   1      }
  66          
  67          // å‘é€åº”ç­”ä½ 
  68          void sendAck(void) {
  69   1          SDA = 0; // å½“SCLä¸ºé«˜ç”µå¹³çš„æ—¶å€™ï¼ŒSDAä¸º0ï¼Œæ‰€ä»¥åº”ç­”ä¸º 0
  70   1          SCL = 1;
  71   1          delay(5); // æŒç»­æ—¶é—´ å¤§äº 4us
  72   1          SCL = 0;
  73   1          // delay(1);
  74   1          SDA = 1;
  75   1      }
  76          
  77          // void sendAck(bit ask) {
  78          //     SDA = ask; // å½“SCLä¸ºé«˜ç”µå¹³çš„æ—¶å€™ï¼ŒSDAä¸º0ï¼Œæ‰€ä»¥åº”ç­”ä¸º 0
  79          //     SCL = 1;
  80          //     delay(5); // æŒç»­æ—¶é—´ å¤§äº 4us
  81          //     SCL = 0;
  82          //     delay(5);
  83          //     
  84          // }
  85          
  86          // å‘é€éåº”ç­”ä½
  87          void unAsk() {
  88   1          SDA = 1; // å½“SCLä¸ºé«˜ç”µå¹³çš„æ—¶å€™ï¼ŒSDAä¸º1ï¼Œæ‰€ä»¥ éåº”ç­”ä¸º 1
  89   1          SCL = 1;
  90   1          delay(5); // æŒç»­æ—¶é—´ å¤§äº 4us
  91   1          SCL = 0;
  92   1          SDA = 1;
  93   1      }
  94          
  95          
  96          // æ¥å—åº”ç­”ä¿¡å·
  97          bit recvAck() {
  98   1          unsigned char flat;
  99   1          SCL = 1;
 100   1          delay(5);
 101   1          //ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­” ï¼šå¦‚æœæœ‰åº”ç­” é‚£ä¹ˆ å™¨ä»¶ä¼šé€šè¿‡ SDA è¿™æ¡çº¿ä¼
             - å›æ•°æ®ï¼Œè¿™æ—¶å•ç‰‡æœºçš„SDAï¼š P1^0 ä¼šæœ‰ç”µå¹³çš„ å˜åŒ–
 102   1          flat = SDA; // å½“ SCLä¸º é«˜ç”µå¹³çš„æ—¶å€™ æ£€æµ‹ SDA çº¿ä¸Šçš„æ•°æ®
 103   1          SCL = 0; // æ•°æ®æ¥å—å®Œæˆåï¼Œ å°†æ—¶é’Ÿç”µå¹³æ‹‰ä½
 104   1          delay(5);
 105   1          return flat; // ä¸º 0 æ—¶ æ˜¯åº”ç­” ä¸º1 æ—¶ æ˜¯éåº”ç­”
 106   1      }
 107          
 108          
 109          
 110          
 111          // å•ç‰‡æœºå‘ å™¨ä»¶å‘é€ä¿¡å·
 112          void sendByte(unsigned char dat){
 113   1          unsigned char i;
 114   1          for (i = 0; i < 8; i++)
C51 COMPILER V9.54   AT24C02                                                               02/08/2022 01:02:06 PAGE 3   

 115   1          {
 116   2              
 117   2              SDA = dat & 0x80;
 118   2              SCL = 1;
 119   2              delay(5);
 120   2              SCL = 0;
 121   2              dat <<= 1;
 122   2          }
 123   1          
 124   1      }
 125          
 126          void readByte(){
 127   1      
 128   1      }
 129          
 130          
 131          /**
 132           * @brief å†™æ“ä½œæ­¥éª¤
 133           * 1ã€å•ç‰‡æœºå‘ç²—èµ·å§‹ä¿¡å· :  I2C_star
 134           * 2ã€å™¨ä»¶å¯»å€æ“ä½œ 1010 A0 A1 A2 W/R  (å¯»å€å†™: 1010 0000)  
 135           * 3ã€ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”
 136           * 4ã€å•ç‰‡æœºå®Œæˆç‰‡å†…åœ°å€æ“ä½œ  (é¦–åœ°å€ï¼š 00H)
 137           * 5ã€å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”ï¼ˆæˆ–éåº”ç­”ï¼‰
 138           * 
 139           * å•ç‰‡æœºå‘é€æ•°æ®å­—èŠ‚
 140           * å™¨ä»¶äº§ç”Ÿåº”ç­”
 141           * å•ç‰‡æœºå‘å‡ºåœæ­¢ä¿¡å· P :  I2C_stop
 142           * 
 143           * 
 144           */
 145          
 146          // å•ç‰‡æœº å†™
 147          void AT24C02_write(){
 148   1          unsigned char i;
 149   1          bit flat;
 150   1          I2C_star(); //èµ·å§‹ä¿¡å·
 151   1          // sendByte(0xa0);// å‘é€è®¾å¤‡åœ°å€ + å†™ä¿¡å· (1010 0000)
 152   1          sendByte(0xa2);// å‘é€è®¾å¤‡åœ°å€ + å†™ä¿¡å· (1010 0000)
 153   1          flat = recvAck(); //åº”ç­”
 154   1          sendByte(0x10); // å‘é€å‚¨å­˜å•åœ°å€
 155   1          flat = recvAck(); //åº”ç­”
 156   1      
 157   1          // å¼€å§‹å†™å…¥æ•°æ®
 158   1          
 159   1          for (i = 0; i < 4; i++)
 160   1          {
 161   2              sendByte(testData[i]);
 162   2              flat = recvAck(); //åº”ç­”
 163   2              if(flat) break;
 164   2          }
 165   1          I2C_stop(); // åœæ­¢
 166   1      
 167   1      }
 168          
 169          
 170          
 171          
 172          
 173          
 174          /**
 175           * @brief å½“å‰åœ°å€è¯»æ“ä½œ
 176           * 1ã€å•ç‰‡æœºå‘ç²—èµ·å§‹ä¿¡å· :  I2C_star
C51 COMPILER V9.54   AT24C02                                                               02/08/2022 01:02:06 PAGE 4   

 177           * 2ã€å™¨ä»¶å¯»å€è¯»æ“ä½œ 1010 A0 A1 A2 W/R  (å¯»å€è¯»: 1010 0001)  
 178           * 3ã€ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”ï¼ˆæˆ–éåº”ç­”ï¼‰
 179           * 4ã€å™¨ä»¶å‘é€æ•°æ®å­—èŠ‚
 180           * 5ã€å•ç‰‡æœºå›å¤å¤åº”ç­”
 181           * 6ã€å•ç‰‡æœºå‘å‡ºåœæ­¢ä¿¡å· P :   I2C_stop
 182           * 
 183           * @return int 
 184           */
 185          
 186          
 187          
 188          /**
 189           * @brief éšæœºè¯» : è¯»å¤šä¸ªå­—èŠ‚
 190           * å•ç‰‡æœºå‘ç²—èµ·å§‹ä¿¡å· :  I2C_star
 191           * å•ç‰‡æœºå®Œæˆ å™¨ä»¶å¯»å€å†™æ“ä½œ ï¼ˆä¼ªå†™ï¼‰
 192           * ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”ï¼ˆæˆ–éåº”ç­”ï¼‰
 193           * å•ç‰‡æœºå®Œæˆ æ•°æ®åœ°å€å†™æ“ä½œ ï¼ˆä¼ªå†™ï¼‰
 194           * ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”ï¼ˆæˆ–éåº”ç­”ï¼‰
 195           * 
 196           * å•ç‰‡æœºå®Œæˆ å™¨ä»¶å¯»å€ è¯»æ“ä½œ
 197           * ç­‰å¾…è¢«é€‰ä¸­çš„å™¨ä»¶è¿”å›ç¡®è®¤åº”ç­”ï¼ˆæˆ–éåº”ç­”ï¼‰
 198           * 
 199           * å™¨ä»¶å‘é€æ•°æ®å­—èŠ‚
 200           * å•ç‰‡æœºäº§ç”Ÿåº”ç­”
 201           * 
 202           * å•ç‰‡æœºå‘å‡ºéåº”ç­”åŠåœæ­¢ä¿¡å· P :   I2C_stop
 203           * 
 204           * 
 205           * @return int 
 206           */
 207          
 208          
 209          
 210          // éšæœºè¯»
 211          
 212          
 213          
 214          // --- æ­¤å¤„å­¦ä¹ ä¸€ä¸‹ _at_0x55  çš„å†™æ³• ï¼›æš‚æ—¶ä¸æ¸…æ¥šå…·ä½“ä»£è¡¨çš„æ„æ€ ----
 215          
 216          
 217          
 218          // unsigned char mem[4]_at_0x55; //ä¹¦ä¸Šè¯´ : å‘é€ç¼“å†²åŒºçš„é¦–åœ°å€(æˆ‘çš„ç†è§£ä¸ºï¼Œå°†mem[4] çš„
             -å­˜å‚¨çš„åœ°å€æŒ‡é’ˆæŒ‡å‘ 0x55)
 219          
 220          // unsigned char men[4] = {0x41, 0x42, 0x43,0x44}; // å‘0x55çš„åœ°å€ å­˜å…¥ å››ä¸ªæ•°æ®ï¼ˆé—®é¢˜æ˜¯å¦‚æ
             -œå­˜ä¸ä¸‹æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿï¼‰
 221          
 222          
 223          int main()
 224          {
 225   1          // delay(5);
 226   1          AT24C02_write();
 227   1          return 0;
 228   1      }
 229          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    170    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   AT24C02                                                               02/08/2022 01:02:06 PAGE 5   

   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
