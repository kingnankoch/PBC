C51 COMPILER V9.54   1_1                                                                   12/16/2021 23:56:18 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 1_1
OBJECT MODULE PLACED IN .\Objects\1-1.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE 1-1.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\
                    -Listings\1-1.lst) TABS(2) OBJECT(.\Objects\1-1.obj)

line level    source

   1          #include "reg51.h"
   2          #include  <intrins.h> //å› ä¸ºè¦è°ƒç”¨nopå‡½æ•°ï¼Œæ‰€ä»¥æ·»åŠ äº†è¿™ä¸ªåº“
   3          // #include "stdio.h";
   4          // #define uchar unsigned  char 
   5          
   6          sbit RS = P3^0;
   7          sbit RW = P3^1;
   8          sbit E = P3^2;
   9          
  10          
  11          sbit T_RST = P3^3;
  12          sbit T_CLK =P3^4;
  13          sbit T_IO =P3^5;
  14          
  15          
  16          unsigned char dateChar[] = {"DATE:"};
  17          unsigned char  timeChar[]={"TIME:"};
  18          unsigned char dateBuffer[10] = {0x32, 0x30, 0, 0, 0x2d, 0, 0, 0x2d, 0, 0}; //asciiç  0x32  = 2 , 0x30 = 0
             -, 0x2d = -
  19          unsigned char timeBuffer[10] = {0, 0, 0x3a, 0, 0, 0x3a, 0, 0}; // 0x3a = :
  20          unsigned char weekBuffer = {0x30};
  21          
  22          // å»¶æ—¶å‡½æ•°
  23          void delay (unsigned int n)
  24          {
  25   1        unsigned int i=0,j=0;
  26   1        for (i = 0; i < n; i++)
  27   1        {
  28   2          for(j=0;j<120;j++);
  29   2        }
  30   1      }
  31          
  32          
  33          void Write(unsigned char dat){
  34   1          unsigned char i;
  35   1          for(i = 8; i > 0;i--){
  36   2              T_IO = dat & 0x01;
  37   2              T_CLK = 1;
  38   2              T_CLK = 0;
  39   2              dat = dat >> 1;
  40   2          }
  41   1      }
  42          
  43          unsigned char Read(void) {
  44   1          unsigned char i, readData = 0;
  45   1          for (i = 8; i> 0; i++){
  46   2              readData = readData >> 1;
  47   2              if(T_IO){
  48   3                  readData |= 0x80; //æ²¡æ˜ç™½ä»€ä¹ˆæ„æ€ï¼Œ æœ€é«˜ä½ç§»åŠ¨åˆ°æœ€ä½ä½ï¼Œç›¸å½“äºä¸€æ¬¡è¿˜å
             -Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ
  49   3      
  50   3              }
  51   2              T_CLK = 1;
  52   2              T_CLK = 0;
C51 COMPILER V9.54   1_1                                                                   12/16/2021 23:56:18 PAGE 2   

  53   2          }
  54   1          return(readData);
  55   1      }
  56          
  57          
  58          void W1302(unsigned char address, unsigned char dat){
  59   1          T_RST = 0;
  60   1          T_CLK = 0;
  61   1          _nop_();
  62   1          _nop_();
  63   1          T_RST = 1;
  64   1          _nop_();
  65   1          _nop_();
  66   1          Write(address);
  67   1          Write(dat);
  68   1          T_CLK = 1;
  69   1          T_RST  =0;
  70   1      
  71   1      }
  72          
  73          unsigned char R1302(unsigned char address){
  74   1          unsigned char dataInfo = 0;
  75   1          T_RST = 0;
  76   1          T_CLK = 0;
  77   1          T_RST = 1;
  78   1          Write(address);
  79   1          // ä¸æ¸…æ¥šè¿™æ­¥è·å–åˆ°çš„æ•°æ®æ˜¯ä»€ä¹ˆå½¢å¼
  80   1          dataInfo = Read();
  81   1          T_CLK = 1;
  82   1          T_RST = 0;
  83   1          return(dataInfo);
  84   1      
  85   1      
  86   1      
  87   1      }
  88          
  89          
  90          
  91          
  92          
  93          // å†™å‘½ä»¤
  94          void wireCommand(unsigned char com) {
  95   1          RS = 0; // ä½ç”µå¹³å¼€å§‹å†™å‘½ä»¤   é«˜ç”µå¹³å†™æ•°æ®
  96   1          RW = 0; // ä½ç”µå¹³ä¸º å†™ï¼Œ é«˜ç”µå¹³ä¸ºè¯» 
  97   1          E = 0;  // ä½¿èƒ½ ç«¯ ä¸‹é™æ²¿æœ‰æ•ˆï¼›  æ ¹æ®æ—¶åºå›¾  åˆå§‹ä½ç”µå¹³ï¼Œç„¶åæ‹‰é«˜ç”µå¹³ å‰ æ”
             -¾å…¥ æ•°æ®
  98   1          P2 = com; // é€šè¿‡ P2å­˜å…¥æ•°æ®
  99   1          delay(5);
 100   1          E = 1; // æ‹‰é«˜ç”µå¹³ å¼€å§‹å†™å…¥æ•°æ®ï¼Œ ç„¶å  æ•°æ®ä¼ è¾“å®Œæˆ æ‹‰ä½
 101   1          E = 0; // æ‹‰ä½ç”µå¹³ æ•°æ®å†™å…¥å®Œæˆï¼Œ
 102   1      }
 103          
 104          // å†™æ•°æ®
 105          void wireData(unsigned char dat){
 106   1          RS = 1; // ä½ç”µå¹³å¼€å§‹å†™å‘½ä»¤   é«˜ç”µå¹³å†™æ•°æ®
 107   1          RW = 0; // ä½ç”µå¹³ä¸º å†™ï¼Œ é«˜ç”µå¹³ä¸ºè¯» 
 108   1          E = 0;  // ä½¿èƒ½ ç«¯ ä¸‹é™æ²¿æœ‰æ•ˆï¼›  æ ¹æ®æ—¶åºå›¾  åˆå§‹ä½ç”µå¹³ï¼Œç„¶åæ‹‰é«˜ç”µå¹³ å‰ æ”
             -¾å…¥ æ•°æ®
 109   1          P2 = dat;// é€šè¿‡ P2å­˜å…¥æ•°æ®
 110   1          delay(5);
 111   1          E = 1; // æ‹‰é«˜ç”µå¹³ å¼€å§‹å†™å…¥æ•°æ®ï¼Œ ç„¶å  æ•°æ®ä¼ è¾“å®Œæˆ æ‹‰ä½
 112   1          E = 0; // æ‹‰ä½ç”µå¹³ æ•°æ®å†™å…¥å®Œæˆï¼Œ
C51 COMPILER V9.54   1_1                                                                   12/16/2021 23:56:18 PAGE 3   

 113   1      }
 114          
 115          
 116          void display(){
 117   1          // wireCommand(0x80);
 118   1          // delay(5);
 119   1          // wireData('K');
 120   1          // delay(5);
 121   1          int i = 0,temp = 0;
 122   1          temp = R1302(0x8d); //è¯»å¹´
 123   1      
 124   1          dateBuffer[2] = 0x30 + temp/16;
 125   1          dateBuffer[3] = 0x30 + temp%16;
 126   1      
 127   1          temp = R1302(0x8B); //è¯»æ˜ŸæœŸ
 128   1          weekBuffer = 0x30 + temp;
 129   1      
 130   1          temp = R1302(0x89); //è¯»æœˆ
 131   1          dateBuffer[5] = 0x30 + temp/16;
 132   1          dateBuffer[6] = 0x30 + temp%16;
 133   1      
 134   1      
 135   1        temp=R1302(0x87); //è¯»æ—¥
 136   1        timeBuffer[8]=0x30+temp/16;
 137   1        timeBuffer[9]=0x30+temp%16;
 138   1      
 139   1      
 140   1          temp=R1302(0x85);   //è¯»å°æ—¶
 141   1        temp=temp&0x7f;
 142   1        timeBuffer[0]=0x30+temp/16;
 143   1        timeBuffer[1]=0x30+temp%16;
 144   1        
 145   1        temp=R1302(0x83);   //è¯»åˆ†
 146   1        timeBuffer[3]=0x30+temp/16;
 147   1        timeBuffer[4]=0x30+temp%16;
 148   1        
 149   1        temp=R1302(0x81);   //è¯»ç§’
 150   1        temp = temp & 0x7f;
 151   1        timeBuffer[6]=0x30+temp/16;
 152   1        timeBuffer[7]=0x30+temp%16;
 153   1      
 154   1      
 155   1      
 156   1          wireCommand(0x80);
 157   1          for (i = 0; i < 5; i++)
 158   1          {
 159   2              /* code */
 160   2              wireData(dateChar[i]);
 161   2          }
 162   1          
 163   1        wireCommand(0xc0);           
 164   1        for (i=0;i<5;i++) 
 165   1        {
 166   2          wireData(timeChar[i]);    
 167   2        }
 168   1      
 169   1        wireCommand(0x86);    //æ˜¾ç¤ºæ—¥å†        
 170   1        for (i=0;i<10;i++) 
 171   1        {
 172   2          wireData(dateBuffer[i]);       
 173   2        } 
 174   1      
C51 COMPILER V9.54   1_1                                                                   12/16/2021 23:56:18 PAGE 4   

 175   1      
 176   1        wireCommand(0xc6);    //æ˜¾ç¤ºæ—¶é—´          
 177   1        for (i=0;i<8;i++) 
 178   1        {
 179   2          wireData(timeBuffer[i]);
 180   2        }
 181   1      
 182   1      }
 183          
 184          
 185          
 186          void initLcd(){
 187   1          // å†™å…¥å‘½ä»¤ 
 188   1          // 00111000  è®¾ç½®16 * 2æ˜¾ç¤ºï¼Œ 5*7ç‚¹é˜µï¼Œ 8ä½æ•°æ®æ¥å£
 189   1          wireCommand(0x38);
 190   1          // 0x0C  00001100 è®¾ç½®å¼€æ˜¾ç¤ºï¼Œ ä¸æ˜¾ç¤ºå…‰æ ‡
 191   1          wireCommand(0x0C);
 192   1          // å†™ä¸€ä¸ªå­—ç¬¦ååœ°å€æŒ‡é’ˆ åŠ ä¸€
 193   1          wireCommand(0x06);
 194   1          // æ˜¾ç¤ºæ¸…é›¶ æ•°æ®æŒ‡é’ˆæ¸…é›¶
 195   1          wireCommand(0x01);
 196   1      
 197   1      }
 198          
 199          
 200          int main()
 201          {
 202   1       
 203   1          /* code */
 204   1          // int i;
 205   1          // printf("%d\n", argc); 
 206   1          // while(argc){
 207   1          //     printf("%s\n", argv[--argc]);
 208   1          // }
 209   1      
 210   1      
 211   1      
 212   1          // while (1)
 213   1          // {
 214   1          //     display();
 215   1          // }
 216   1          // int i;
 217   1          // int readdat = 00001110;
 218   1          // int  T_IO;
 219   1          // for(i=0;i< 8; i++) {
 220   1          //     T_IO = readdat & 0x01;
 221   1          //     readdat = readdat >> 1;
 222   1          //     printf(" %d \n", readdat);
 223   1          //     printf("T_IO == %d \n", T_IO);
 224   1          // }
 225   1      
 226   1         initLcd();
 227   1         W1302(0x8e, 0);      // æ‰“å¼€å†™ä¿æŠ¤ 
 228   1         W1302(0x8c, 0x20);   // å†™å…¥å¹´ 
 229   1         W1302(0x8A, 0x01);   // å†™å…¥æ˜ŸæœŸ
 230   1         W1302(0x88, 0x12);   //å†™å…¥æœˆ
 231   1         W1302(0x86, 0x27);   //å†™å…¥æ—¥
 232   1         W1302(0x84, 0x22);   //å†™å…¥å°æ—¶
 233   1         W1302(0x82, 0x35);   //å†™å…¥åˆ†
 234   1         W1302(0x80, 0x44);   //å†™å…¥ç§’
 235   1         W1302(0x8e, 0x80);   //å…³é—­å†™ä¿æŠ¤
 236   1         while (1)
C51 COMPILER V9.54   1_1                                                                   12/16/2021 23:56:18 PAGE 5   

 237   1         {
 238   2             /* code */
 239   2             display();
 240   2         }
 241   1         
 242   1      
 243   1      
 244   1      
 245   1          return 0;
 246   1      }
 247          
*** WARNING C294 IN LINE 245 OF 1-1.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    589    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     33    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
